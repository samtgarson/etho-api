angular
  .module('app')
  .factory('Endpoint', function() {
    return function(path) {
      url = '<%= Rails.application.routes.url_helpers.api_root_url %>'
      if (path.join) return url + path.join('/');
      return url + path
    }
  })
  .service('User', [
    'Endpoint',
    '$http',
    '$cookies',
    function(Endpoint, $http, $cookies){
      return {
        user: null,
        get: function() {
          if (this.user) return this.user;
          if ($cookies.get('user')) {
            this.user = $cookies.getObject('user')
            return this.user
          }
          return $http.get(Endpoint(['users', 'me']))
        },
        set: function(u) {
          this.user = u;
          $cookies.putObject('user', u);
        }
      }
  }])
  .service('Token', [
    '$cookies',
    function($cookies){
      return {
        token: null,
        get: function() {
          if (this.token) return this.token;
          if ($cookies.get('token')) {
            this.token = $cookies.get('token')
            return this.token
          }
          return false
        },
        set: function(t) {
          this.token = t;
          $cookies.put('token', t);
        }
      }
  }])
